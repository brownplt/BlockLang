<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Loader</title>
    <script type="text/javascript" src="../../closure-library/closure/goog/base.js"></script>
    <script type="text/javascript" src="../ray-deps.js"></script>
    <script>
        goog.require('Blockly');
        goog.require('Blockly.Xml');
    </script>
    <style>
        html, body {
            background-color: #fff;
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }
        .blocklySvg {
            height: 100%;
            width: 100%;
        }
    </style>
    <script>
        function init() {
            // Context menus.
            Blockly.MSG_DUPLICATE_BLOCK = 'Duplicate';
            Blockly.MSG_REMOVE_COMMENT = 'Remove Comment';
            Blockly.MSG_ADD_COMMENT = 'Add Comment';
            Blockly.MSG_EXTERNAL_INPUTS = 'External Inputs';
            Blockly.MSG_INLINE_INPUTS = 'Inline Inputs';
            Blockly.MSG_DELETE_BLOCK = 'Delete Block';
            Blockly.MSG_DELETE_X_BLOCKS = 'Delete %1 Blocks';
            Blockly.MSG_COLLAPSE_BLOCK = 'Collapse Block';
            Blockly.MSG_EXPAND_BLOCK = 'Expand Block';
            Blockly.MSG_DISABLE_BLOCK = 'Disable Block';
            Blockly.MSG_ENABLE_BLOCK = 'Enable Block';
            Blockly.MSG_HELP = 'Help';
            Blockly.MSG_COLLAPSE_ALL = 'Collapse Blocks';
            Blockly.MSG_EXPAND_ALL = 'Expand Blocks';

            var Ray = window.parent.Ray;
            Ray.Shared.attachToBlockly(Blockly);
            Ray.Shared.registerFunDefBlockly(Blockly);
            var funDefInfo = window.parent.funDefInfo_;
            Blockly.FunDefBlocks = funDefInfo.args;
            Blockly.FunName = funDefInfo.funName;
            Blockly.FunSpec = funDefInfo.funSpec;

            Blockly.inject(document.body,
                           {path: "../../blockly/", toolbox:
                                   Ray.Shared.getToolbox(true)});

            var initialBlocks = funDefInfo.initialBlocks;
            if(initialBlocks) {
                goog.array.map(initialBlocks, function(blockName) {
                    var block = new Blockly.Block(Blockly.mainWorkspace, blockName);
                    block.initSvg();
                    block.render();
                });
            }
        }
    </script>
</head>
<body onload="init()">
</body>
</html>
